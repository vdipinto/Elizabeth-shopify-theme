{% assign current_variant = product.selected_or_first_available_variant %}
{% assign featured_image = current_variant.featured_image | default: product.featured_image %}

<img
  src="{{ featured_image | img_url: '800x800' }}"
  alt="{{ featured_image.alt | escape }}"
  id="ProductPhotoImg"
  width="800"
  height="800"
>
{% for image in product.images %}
  <a href="{{ image.src | img_url: '1200x1200' }}">
    <img
      src="{{ image.src | img_url: '300x300' }}"
      alt="{{ image.alt | escape }}"
      width="300"
      height="300"
    >
  </a>
{% endfor %}

<h1>{{ product.title }}</h1>

<form
  action="/cart/add"
  method="post"
  enctype="multipart/form-data"
  id="AddToCartForm"
  x-data="{
    async addToCart() {
      const formData = {
        items: [{
          id: this.$refs.select.value,
          quantity: parseInt(this.$refs.qty.value, 10) || 1
        }]
      };
      
      try {
        const response = await fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });
        
        if (response.ok) {
          // Dispatch event to open cart drawer
          this.$dispatch('cart:add');
          console.log('Product added to cart successfully');
        } else {
          console.error('Failed to add product to cart');
        }
      } catch (error) {
        console.error('Error adding product to cart:', error);
      }
    }
  }"
  @submit.prevent="addToCart()"
>
  <select name="id" id="productSelect" x-ref="select">
    {% for variant in product.variants %}
      {% if variant.available %}
        <option value="{{ variant.id }}">
          {{ variant.title }} – {{ variant.price | money_with_currency }}
        </option>
      {% else %}
        <option value="{{ variant.id }}" disabled>
          {{ variant.title }} – {{ 'products.product.sold_out' | t }}
        </option>
      {% endif %}
    {% endfor %}
  </select>

  <div class="mt-2">{{ current_variant.price | money }}</div>

  <label for="Quantity">Quantity</label>
  <input
    type="number"
    id="Quantity"
    name="quantity"
    value="1"
    min="1"
    x-ref="qty"
  >

  <button type="submit" name="add" id="AddToCart">Add to cart</button>
</form>

<div>{{ product.description }}</div>
